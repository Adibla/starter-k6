---------------------
## Introduction 
This repository contains stress testing, it includes a basic project structure with:
- Containerized Graphana dashboard and influxdb
- Example scripts with data autogenerated
- Local inclusion of external module
- Env management
- Possibility to split scripts in multiple file with main index.js

## Start infrastructure
In order to run influxdb and graphana from docker-compose, run

`$ docker-compose up -d influxdb grafana`

## Start Mockserver
Start Microcks mock server

`$ docker-compose up -d app mongo keycloak postman`

It will start Microcks with default keycloak configuration on port 8083

Credentials:

Username: admin

Password: microcks123

## Import mock data
After starting Microcks server import sample open api 3.0 file, from 

**/microcks/sample/pastry-openapi3.yaml**

Visit 
[this](https://microcks.io/) for more informations

## Update local config
To try these tests on your local setup, update config file located in **./env/local/settings.json** you should sobstitute found base_url ip with your personal machine url (used for infra containers communication)

## Run test
`$ docker-compose run k6`

## Run test with specific config or custom env
`$ docker-compose run -e OPTIONS_SET="stress" -e EXECUTION="production" k6`

## Run only some tests
You can exclude or include some tests based on properties TEST_INCLUDES, and TEST_EXCLUDES, they accept a list of script name as a regex pattern separated by |

`$ docker-compose run -e OPTIONS_SET="stress" -e TEST_INCLUDES="^test_1$|test_2" -e EXECUTION="production" k6`

The example above will include every script name that exactly corrispond to "test_1" and every scripts that contain test_2 in his name.

`$ docker-compose run -e OPTIONS_SET="stress" -e TEST_EXCLUDES="^test_1$|test_2" -e EXECUTION="production" k6`

The example above do the same but in exclusion

You could also pass these properties from settings.json, as properties "test_includes" and "test_excludes"

```json
{
    "test_includes": ["^id_1$", "id_2"],
    "test_excludes": ["id_3"]
}
```

## Run test with seed generation or existing seed data
Inserting **SEED_OR_RUN** or **SEED_DATA** is required in order to run every tests with success, if you don't include them, some tests will fail

`$ docker-compose run -e SEED_ON_RUN=true -e LEGACY_AUTH_TOKEN=xyz k6`

> **SEED_ON_RUN**  generate remote entity using api, if you already have existing data use **SEED_DATA** as an object with required values

`$ docker-compose run -e SEED_ON_RUN=false -e SEED_DATA="{\"id\": \"xyz\"}" k6`

## Visualize runned tests
Your local results can be visualized on **localhost:3000**, exposed as a Graphana Dashhboard.

## Project structure detail
### `/dashboards`

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam ac mollis sem. Morbi ultrices at lectus
in mattis. Aenean eu nunc et erat tempus gravida

Suspendisse at mauris ut ante viverra fermentum. Aenean in tortor non tellus facilisis luctus. Maecenas in efficitur orci. Aliquam erat volutpat. Sed non efficitur enim, in
### `/env`
### `/src`
### `/vendor`
### `/vendor`

## Other files
### `/docker-compose.yml`
